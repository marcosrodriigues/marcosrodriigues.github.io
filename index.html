<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta charset="UTF-8">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">

        <title>Grade de Computação - UFOP</title>

        <style>
            .cabecalho {
                width: 100%;
                height: 150px !important;
                text-align: center;
                position: relative;
            }
            .center {
                text-align: center;
                height: 150px;
            }
            .center h3 {
                font-size: 26px;
                margin: 0;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }
            .left {
                float: left;
            }
            .right {
                float: right;
            }
            .matriz {
                height: 100%;
                width: 100%;
            }
            .matriz .cell {
                width: 130px;
                height: 130px;
                float: left;
                margin: 6px;
                border: 1px solid #000000;
                text-align: center;
                padding: 10px;
                cursor: pointer;
            }
            .matriz .cell-empty {
                width: 130px;
                height: 130px;
                float: left;
                margin: 6px;
                padding: 10px;
            }
            .matriz .linha {
                overflow: auto;
            }
            .matriz .cell p {
                text-align: center;
                font-weight: bold;
                font-size: 12px;
            }
            .available {
                background-color: lightblue;
            }
            .done {
                background-color: lightgreen;
            }
            .blocked {
                background-color: lightcoral;
            }
        </style>
    </head>

    <body class="bg-light">
        <div class="container">
            <section class="cabecalho">
                <div class="center">
                    <a href="http://www.decom.ufop.br/" target="_blank" class="left">
                        <img src="http://www.decom.ufop.br/sibgrapi2012/images/stories/decom.png" width="150" height="150" />
                    </a>
                    <a href="https://ufop.br/" target="_blank" class="right">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/b/b9/UFOP_logo.gif" width="72" height="150" />
                    </a>
                    <h3>Grade de Computação da UFOP - Currículo 4</h3>
                </div>
            </section>

            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="left">
                            <h4>Contribua com o <a href="https://github.com/marcosrodriigues/ufop" target="_blank">repositório de matérias do curso</a>.</h4>
                    </div>
                    <div class="right">
                        <strong>Total de horas cursadas: </strong>
                        <span id="total">0</span>h
                    </div>
                </div>
            </div>
    
            <div class="matriz">
                <div class="linha">
                    <div class="cell available" id="MTM_122">
                        <p>MTM 122 - Cálculo Diferencial e Integral I</p>
                        <p>Carga horária: 90h</p>
                        <input type="hidden" name="carga" value=90>
                    </div>
                    <div class="cell blocked" id="MTM_123">
                        <p>MTM 123 - Cálculo Diferencial e Integral II</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["MTM_122"]' />
                    </div>
                    <div class="cell blocked" id="MTM_112">
                        <p>MTM 112 - Introdução à Algebra Linear</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["MTM_131"]' />
                    </div>
                    <div class="cell blocked" id="EST_202">
                        <p>EST 202 - Estatística e Probabilidade</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["MTM_122"]' />
                    </div>
                    <div class="cell blocked" id="BCC_244">
                        <p>BCC 244 - Teoria da Computação</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_102", "BCC_202"]' />
                    </div>
                    <div class="cell blocked" id="BCC_328">
                        <p>BCC 328 - Construção de Compiladores I</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_221", "BCC_244"]' />
                    </div>
                    <div class="cell blocked" id="BCC_390">
                        <p>BCC 390 - Monografia I</p>
                        <p>Carga horária: 120h</p>
                        <input type="hidden" name="carga" value=120>
                        <input type='hidden' name="required" value='["BCC_502", "__1500__"]' />
                    </div>
                    <div class="cell blocked" id="BCC_391">
                        <p>BCC 391 - Monografia II</p>
                        <p>Carga horária: 120h</p>
                        <input type="hidden" name="carga" value=120>
                        <input type='hidden' name="required" value='["BCC_390"]' />
                    </div>
                </div>
                <div class="linha">
                    <div class="cell available" id="MTM_131">
                        <p>MTM 131 - Geometria Analítica e Cálculo Vetorial</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                    </div>
                    <div class="cell available" id="BCC_101">
                        <p>BCC 101 - Matemática Discreta I</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                    </div>
                    <div class="cell blocked" id="BCC_102">
                        <p>BCC 102 - Matemática Discreta II</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_101"]' />
                    </div>
                    <div class="cell blocked" id="BCC_760">
                        <p>BCC 760 - Cálculo Numérico</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_201", "MTM_123"]' />
                    </div>
                    <div class="cell blocked" id="BCC_321">
                        <p>BCC 321 - Banco de Dados I</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_102", "BCC_203"]' />
                    </div>
                    <div class="cell blocked" id="BCC_325">
                        <p>BCC 325 - Inteligência Artificial</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_101", "BCC_204"]' />
                    </div>
                    <div class="cell blocked" id="BCC_503">
                        <p>BCC 503 - Informática e Sociedade</p>
                        <p>Carga horária: 30h</p>
                        <input type="hidden" name="carga" value=30>
                        <input type='hidden' name="required" value='["__1500__"]' />
                    </div>
                    <div class="cell blocked" id="PRO_302">
                        <p>PRO 302 - Ações Empreendedoras</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["__1500__"]' />
                    </div>
                </div>
                <div class="linha">
                    <div class="cell available" id="BCC_501">
                        <p>BCC 501 - Introdução à Ciência da Computação</p>
                        <p>Carga horária: 30h</p>
                        <input type="hidden" name="carga" value=30>
                    </div>
                    <div class="cell blocked" id="BCC_324">
                        <p>BCC 324 - Interação Humano-Computador</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_201"]' />
                    </div>
                    <div class="cell blocked" id="BCC_222">
                        <p>BCC 222 - Programação Funcional</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_201"]' />
                    </div>
                    <div class="cell blocked" id="BCC_204">
                        <p>BCC 204 - Teoria dos Grafos</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_202"]' />
                    </div>
                    <div class="cell blocked" id="BCC_241">
                        <p>BCC 241 - Projeto e Análise de Algoritmos</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_204"]' />
                    </div>
                    <div class="cell blocked" id="BCC_342">
                        <p>BCC 342 - Introdução à Otimização</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_201"]' />
                    </div>
                    <div class="cell blocked" id="FIL_101">
                        <p>FIL 101 - Introdução à História da Filosofia</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["__1500__"]' />
                    </div>
                    <div class="cell blocked" id="DIR_249">
                        <p>DIR 249 - Direito da Informática</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["__1500__"]' />
                    </div>
                </div>
                <div class="linha">
                    <div class="cell-empty" style="border: 0px;" id="4x1">
                    </div>
                    <div class="cell available" id="EAD_700">
                        <p>EAD 700 - Prática de Leitura e Produção de Texto</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                    </div>
                    <div class="cell blocked" id="BCC_221">
                        <p>BCC 221 - Programação Orientada à Objetos</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_202"]' />
                    </div>
                    <div class="cell blocked" id="BCC_322">
                        <p>BCC 322 - Engenharia de Software I</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_221"]' />
                    </div>
                    <div class="cell blocked" id="BCC_323">
                        <p>BCC 323 - Engenharia II</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_322"]' />
                    </div>
                    <div class="cell blocked" id="BCC_327">
                        <p>BCC 327 - Computação Gráfica</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_202", "MTM_112"]' />
                    </div>
                    <div class="cell blocked eletiva" id="4x7">
                        <p>Disciplina Eletiva</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["__720__"]' />
                    </div>
                    <div class="cell blocked facultativa" id="4x8">
                        <p>Disciplina Facultativa</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["__720__"]' />
                    </div>
                </div>
                <div class="linha">
                    <div class="cell available" id="BCC_201">
                        <p>BCC 201 - Introdução à Programação</p>
                        <p>Carga horária: 90h</p>
                        <input type="hidden" name="carga" value=90>
                    </div>
                    <div class="cell blocked" id="BCC_202">
                        <p>BCC 202 - Estrutura de Dados I</p>
                        <p>Carga horária: 90h</p>
                        <input type="hidden" name="carga" value=90>
                        <input type='hidden' name="required" value='["BCC_201"]' />
                    </div>
                    <div class="cell blocked" id="BCC_203">
                        <p>BCC 203 - Estrutura de Dados II</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_202"]' />
                    </div>
                    <div class="cell blocked" id="BCC_361">
                        <p>BCC 361 - Redes de Computadores</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_202", "BCC_263"]' />
                    </div>
                    <div class="cell blocked" id="BCC_362">
                        <p>BCC 362 - Sistemas Distribuídos</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_361", "BCC_264"]' />
                    </div>
                    <div class="cell blocked" id="BCC_326">
                        <p>BCC 326 - Processamento de Imagens</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_202", "MTM_123"]' />
                    </div>
                    <div class="cell blocked eletiva" id="5x7">
                        <p>Disciplina Eletiva</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["__720__"]' />
                    </div>
                    <div class="cell blocked eletiva" id="5x8">
                        <p>Disciplina Eletiva</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["__720__"]' />
                    </div>
                </div>
                <div class="linha">
                    <div class="cell available" id="BCC_265">
                        <p>BCC 265 - Eletronica para Computação</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                    </div>
                    <div class="cell blocked" id="BCC_266">
                        <p>BCC 266 - Organização de Computadores</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_265", "BCC_201"]' />
                    </div>
                    <div class="cell blocked" id="BCC_263">
                        <p>BCC 263 - Arquitetura de Computadores</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_266"]' />
                    </div>
                    <div class="cell blocked" id="BCC_264">
                        <p>BCC 264 - Sistemas Operacionais</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["BCC_202", "BCC_263"]' />
                    </div>
                    <div class="cell blocked" id="BCC_502">
                        <p>BCC 502 - Metodologia Científica em Ciência da Computação</p>
                        <p>Carga horária: 30h</p>
                        <input type="hidden" name="carga" value=30h>
                        <input type='hidden' name="required" value='["__720__"]' />
                    </div>
                    <div class="cell blocked eletiva" id="6x6">
                        <p>Disciplina Eletiva</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["__720__"]' />
                    </div>
                    <div class="cell blocked eletiva" id="6x7">
                        <p>Disciplina Eletiva</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["__720__"]' />
                    </div>
                    <div class="cell blocked eletiva" id="6x8">
                        <p>Disciplina Eletiva</p>
                        <p>Carga horária: 60h</p>
                        <input type="hidden" name="carga" value=60>
                        <input type='hidden' name="required" value='["__720__"]' />
                    </div>
                </div>
            </div>
        

        </div>
    </body>
</html>

<script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>

<script>
    $().ready(function() {
        atualizarMatriz();
        calcularTotalHoras();
    });
    var total = 0;
    //ao clicar em qualquer cedula
    $('.cell').click(function(e) {
        //pega as classes da cell clicada
        var classe = $(this).attr('class');
        
        //se ela estiver como "available"
        if (classe.indexOf('available') >= 0) {
            //troca para "done"
            $(this).removeClass('available');
            $(this).addClass('done');
        
        //se ela estiver como "blocked"
        } else if (classe.indexOf('blocked') >= 0) {
            //ignora
            e.preventDefault();
            return;
        } else {
            //senao, por default, ela vai estar disponível
            $(this).removeClass('done');
            $(this).addClass('available');
        }
        //atualiza a matriz
        atualizarMatriz();
        //nao se sabe pq diabos so funciona 100% rodando 2x
        atualizarMatriz();
    })
    function calcularTotalHoras() {
        //inicializa total de horas com 0
        total = 0;
        //pra cada cell
        $.each($('.cell'), function(index, value) {
            var cell = $(this).attr('class');
            //se ela estiver marcada como "done"
            if (cell.indexOf('done') >= 0) {
                //busco o valor da carga horaria dela e somo ao total
                var cargaHoraria = $(this).children("input[name='carga']").val();
                total = total + parseInt(cargaHoraria);
            }
        });
        
        //atribuo o total calculado pro texto
        $('#total').text(total.toString());
    }
    //atualiza 
    function atualizarMatriz() {
        //primeiro calcula o o total de horas cursadas
        //esse valor eh usado pra liberar cursos com carga horaria como pre requisito
        calcularTotalHoras();
        //pra cada cell
        $.each($('.cell'), function(index, value) {
            var cell = $(this);
            //pego o input required, que tem os pre requisitos da materia
            var child = $(this).children("input[name='required']");
            if (child.length > 0) {
                //transformo em uma lista 
                var requireds = JSON.parse(child.val());
                //defino "available" como padrão
                var available = true;
                //pra cada required
                for (var i = 0; i < requireds.length; i++) {
                    var field = requireds[i];
                    
                    //Padrão de required:
                    //__1000__  -> 1000 horas de pre requisito
                    //BCC_101 -> BCC 101 como pre requisito
                    //se nao tiver "__", o pre requisito eh disciplina
                    if (field.indexOf("__") < 0) {
                        //se a disciplina nao estiver como "done"
                        if ($('#' + field).attr('class').indexOf('done') < 0) {
                            //bloqueia a materia
                            available = false;
                        }
                    } else {
                        //se tiver no padrão __NUM__, o pre requisito eh hora de curso 
                        var hours = field.split("__")[1];
                        
                        //Por default, essas cadeiras são travadas
                        available = false;
                        //Mas se vc tiver hora suficiente
                        if (total >= hours) {
                            //pode fazer! :)
                            available = true;
                        }
                    }
                }
                //Se o available virou "false"
                if (!available) {
                    cell.removeAttr("class");
                    //entao a cell ta bloqueada
                    cell.attr("class", "cell blocked")
                } else {
                    //senao eu tiro o bloqueio dela
                    cell.removeClass('blocked');
                    //e se por acaso ela nao estiver com "done" e nem com "available"
                    if (cell.attr('class').indexOf('done') < 0 &&
                        cell.attr('class').indexOf('available') < 0) {
                            //eu seto o available pra ela
                            cell.addClass('available');
                        }
                    
                } 
            }
        });
        //e depois de todo esse role, calculo a quantidade de horas cursadas denovo! :)
        calcularTotalHoras();
    }
</script>